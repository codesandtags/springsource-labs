<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Dependency Injection with XML</title><link rel="stylesheet" href="css/html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.70.0"><link rel="start" href="index.html" title="Core Spring Training - Lab Documentation"><link rel="up" href="index.html" title="Core Spring Training - Lab Documentation"><link rel="prev" href="spring-intro-lab.html" title="Introduction to Core Spring"><link rel="next" href="xml-dependency-best-practices.html" title="Dependency Injection Best Practices"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div xmlns="http://www.w3.org/TR/xhtml1/transitional" style="background-color:white;border:none;height:73px;border:1px solid black;"><a style="border:none;" href="http://www.springframework.org/" title="The Spring Framework"><img style="border:none;" src="images/xdev-spring_logo.jpg"></img></a><a style="border:none;" href="http://www.springsource.com/" title="SpringSource"><img style="border:none;position:absolute;padding-top:5px;right:42px;" src="images/springsource-banner-rhs.jpg"></img></a></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="xml-dependency-injection"></a>Dependency Injection with XML</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="dependency-injection-with-xml-introduction"></a>1.&nbsp;Introduction</h2></div></div></div><p>In this lab you will gain experience using Spring to configure the
    completed <a href="reference-domain.html" title="Reward Dining: The Course Reference Domain">rewards application</a>.
    You'll use Spring to configure the pieces of the application, then run a
    top-down system test to verify application behavior.</p><div class="orderedlist"><p class="title"><b>What you will learn:</b></p><ol type="1"><li><p>The <span class="emphasis"><em>big picture</em></span>: how Spring "fits" into the
        architecture of a typical Enterprise Java application</p></li><li><p>How to use Spring to configure plain Java objects (POJOs)</p></li><li><p>How to organize Spring configuration files effectively</p></li><li><p>How to create a Spring
        <code class="interfacename">ApplicationContext</code> and get a bean from
        it</p></li><li><p>How to use SpringSource Tool Suite to visualize your
        application's configuration</p></li><li><p>How Spring, combined with modern development tools, facilitates a
        test-driven development process</p></li></ol></div><div class="orderedlist"><p class="title"><b>Specific subjects you will gain experience with:</b></p><ol type="1"><li><p>Constructor dependency injection</p></li><li><p>Setter dependency injection</p></li><li><p>Spring XML configuration syntax</p></li><li><p>Spring 3 embedded database support</p></li><li><p>SpringSource Tool Suite</p></li></ol></div><p>Estimated time to complete: 45 minutes</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="dependency-injection-withxml-lab-quick-instructions"></a>2.&nbsp;Quick Instructions</h2></div></div></div><p>If you feel you have a good understanding of the material, implement
    the tasks listed here. Alternatively, the next section contains more
    detailed step-by-step instructions. If you aren't sure at any
    point, each task here is also described in more detail by a corresponding
    section in the step-by-step instructions.</p><div class="orderedlist"><p class="title"><b>Create the Application Configuration </b></p><ol type="1"><li><p><span class="bold"><strong>Creating application config file</strong></span> (<a href="xml-dependency-injection.html#details.app-creation" title="3.1.&nbsp;Creating the application configuration">details</a>)</p><p>Inside the package <code class="filename">rewards/internal</code>, create a Spring configurartion file called <code class="filename">application-config.xml</code>. Define
        your four business beans in it as shown below, in the
        'application-config.xml' box. 
        	</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Don't worry about the infrastructure
        configuration defined in 'some-other-file.xml' box. </p></td></tr></table></div><p>For consistency
        with the rest of the lab, give your
        <code class="literal">RewardNetworkImpl</code> bean an id of
        <code class="literal">rewardNetwork</code>.</p><div class="mediaobject" align="center"><img src="images/xml-dependency-injection/rewards-configuration-diagram-application.png" align="middle"><div class="caption"><p>Figure 1: Application configuration</p></div></div></li><li><p><span class="bold"><strong>Visualize the application configuration</strong></span> (<a href="xml-dependency-injection.html#details.app-visualization" title="3.1.2.&nbsp;Visualize the application configuration file">details</a>)</p><p>Verify if you defined your
        <code class="filename">application-config.xml</code> file correctly. Click on the <span class="emphasis"><em>Beans Graph</em></span> tab in your <code class="filename">application-config.xml</code> editor window. If you see something different, head back to
        your configuration to find the issue. When you make a change to your
        configuration, refresh your graph.</p><div class="mediaobject" align="center"><img src="images/xml-dependency-injection/spring-ide-application-config-graph.png" align="middle"><div class="caption"><p>Figure 2: <code class="filename">application-config.xml</code> visualized with SpringSource Tool Suite</p></div></div></li><li><p><span class="bold"><strong>Infrastructure configuration</strong></span> (<a href="xml-dependency-injection.html#details.infra-config" title="3.1.3.&nbsp;The infrastructure configuration needed to test the application">details</a>)</p><p>Next the infrastructure configuration necessary to test your
        application. We need a datasource for your application to use to
        acquire database connections in a test environment. Open the
        <code class="filename">test-infrastructure-config.xml</code> file and verify
        the datasource and database connection code.</p></li><li><p><span class="bold"><strong>Visualize the complete configuration</strong></span> (<a href="xml-dependency-injection.html#details.visualize-all" title="3.1.4.&nbsp;Visualize the complete test configuration">details</a>)</p><p>Add the <code class="filename">test-infrastructure-config.xml</code> file
        to the Config Files list. </p><p>In the <span class="emphasis"><em>Spring Explorer</em></span> view, right-click on your <code class="literal">xml-dependency-injection</code>
        project and select <span class="emphasis"><em>Properties</em></span>. Select the
        <code class="literal">Spring -&gt; Beans Support</code> tab and
        <span class="emphasis"><em>Add...</em></span> your
        <code class="filename">test-infrastructure-config.xml</code> to the Config
        Files list.</p><p>Now group the two files together into a logical 'systemTest'
        Config Set. To do this, select the Config Sets tab and select
        <span class="emphasis"><em>New...</em></span> In the dialog, enter the Config Set name,
        select the config files to include, and select
        <span class="emphasis"><em>OK</em></span></p><p>Now graph your new 'systemTest' Config Set. In your Spring
        Explorer view, right-click on the set and select <span class="emphasis"><em>Open Graph</em></span>. Your graph should look like:</p><div class="mediaobject" align="center"><img src="images/xml-dependency-injection/system-test-configset.png" align="middle"><div class="caption"><p>Figure 3: The rewards application - system test configuration</p></div></div></li></ol></div><div class="orderedlist"><p class="title"><b>System testing the application with Spring and JUnit</b></p><ol type="1"><li><p><span class="bold"><strong>Create the system test class</strong></span> (<a href="xml-dependency-injection.html#details.system-test-create" title="3.2.1.&nbsp;Create the system test class">details</a>)</p><p>Create a new JUnit test called
        <code class="literal">RewardNetworkTests</code> in the
        <code class="literal">rewards</code> package inside the
        <code class="literal">src/test/java</code> source folder.</p></li><li><p><span class="bold"><strong>Implement test setup logic</strong></span> (<a href="xml-dependency-injection.html#details.system-test-setup" title="3.2.2.&nbsp;Implement the test setup logic">details</a>)</p><p>Add the test setup logic required to run your system
        test. In this method, you will need to create an application context and configure it with the Spring Bean configuration files you just created (<code class="filename">application-config.xml</code> and <code class="filename">test-infrastructure-config.xml</code>). In addition, you need to ask the application context for the <span class="emphasis"><em>rewardNetwork</em></span> bean for you. Assign this as a private field you can reference in your test methods.</p></li><li><p><span class="bold"><strong>Implement test logic</strong></span> (<a href="xml-dependency-injection.html#details.system-test-implement" title="3.2.3.&nbsp;Implement the test logic">details</a>)</p><p>Copy the unit test (the <code class="literal">@Test</code> method) from
        <code class="classname">RewardNetworkImplTests.testRewardForDining()</code> - we are testing the
        same code, but using a different setup.</p></li><li><p><span class="bold"><strong>Run the test</strong></span></p><p>With the test setup logic implemented, you're ready to test your
        application. Run your new unit test. It will invoke
        <code class="literal">RewardNetwork.rewardAccountFor(Dining)</code> method to
        verify all pieces of your application work together to carry out a
        successful reward operation.</p><p>Congratulations the lab is finished.</p></li></ol></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="dependency-injection-with-xml-instructions"></a>3.&nbsp;Detailed Instructions</h2></div></div></div><p>Instructions for this lab are divided into two sections. In the
    first section, you'll use Spring to configure the pieces of the rewards
    application. In the second section, you'll run a system test to verify all
    the pieces work together to carry out application behavior successfully.
    Have fun!</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="details.app-creation"></a>3.1.&nbsp;Creating the application configuration</h3></div></div></div><p>So far you've coded your <code class="classname">RewardNetworkImpl</code>,
      the central piece of this reward application. You've unit tested it and
      verified it works in isolation with dummy (stub) repositories. Now it is
      time to tie all the <span class="emphasis"><em>real</em></span> pieces of the application
      together, integrating your code with supporting services that have been
      provided for you. In the following steps you'll use Spring to configure
      the complete rewards application from its parts. This includes plugging
      in repository implementations that use a JDBC data source to access a
      relational database!</p><p>Below is a configuration diagram showing the parts of the rewards
      application you will configure and how they should be wired
      together:</p><div class="mediaobject" align="center"><a name="reward-network-system-diagram-annotated"></a><img src="images/xml-dependency-injection/reward-network-system-diagram-annotated.png" align="middle"><div class="caption"><p>Figure 4: The rewards application configuration diagram</p></div></div><p>The <a href="xml-dependency-injection.html#reward-network-system-diagram-annotated">diagram</a> shows the configuration split into two
      categories: Application Configuration and Infrastructure Configuration.
      The components in the Application Configuration box are written by you
      and makeup the application logic. The components in the Infrastructure
      Configuration box are not written by you and are lower-level services
      used by the application. In the next few steps you'll focus on the
      application configuration piece. You'll define the infrastructure piece
      later.</p><p>In your project, you'll find your familiar
      <code class="classname">RewardNetworkImpl</code> in the
      <code class="literal">rewards.internal</code> package. You'll find each JDBC-based
      repository implementation it needs located within the domain packages
      inside the <code class="filename">rewards.internal</code> package. Each
      repository uses the JDBC API to execute SQL statements against a
      <code class="interfacename">DataSource</code> that is part of the
      application infrastructure. The
      <code class="interfacename">DataSource</code> implementation you will use is
      not important at this time but will become important later.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e966"></a>3.1.1.&nbsp;Create the application configuration file</h4></div></div></div><p>Spring configuration information is typically externalized from
        Java code, partitioned across one or more XML files. In this step
        you'll create a single XML file that tells Spring how to configure
        your application components. You'll then validate your configuration
        visually using SpringSource Tool Suite's graphical visualizer.</p><p>Under the <code class="filename">src/main/java</code> folder, right-click
        the <code class="literal">rewards.internal</code> package and select
        <span class="emphasis"><em>New -&gt; Spring Bean Configuration File</em></span>. Use
        <code class="filename">application-config.xml</code> as the file name to
        indicate this is where your application configuration will reside.
        Leave the 'Add Spring project nature if required' checkbox checked and
        click <span class="emphasis"><em>Next</em></span>.</p><p>In the next screen, note that by clicking on the 'beans'
        namespace, you can select XSD files for different version of Spring.
        The default is 3.0 so you can either choose that explicitly or leave
        it unchecked. After that, click <span class="emphasis"><em>Finish</em></span>.</p><div class="mediaobject" align="center"><a name="xsd-selection"></a><img src="images/xml-dependency-injection/xsd-selection.png" align="middle"><div class="caption"><p>Figure 5: XSD selection</p></div></div><p>Now, in <code class="filename">application-config.xml</code> create the
        configuration illustrated in the 'application-config.xml' box
        below:</p><div class="mediaobject" align="center"><a name="rewards-configuration-diagram-application"></a><img src="images/xml-dependency-injection/rewards-configuration-diagram-application.png" align="middle"><div class="caption"><p>Figure 6: Application configuration</p></div></div><p>In the <a href="xml-dependency-injection.html#rewards-configuration-diagram-application">diagram</a>, the colored rectangular boxes represent
        bean definitions, and the labeled arrows between them represent bean
        references. The entire configuration is shown split out across two
        files, <code class="filename">application-config.xml</code> and
        <code class="filename">some-other-file.xml</code>. This is because it is
        generally a best-practice to separate application and infrastructure
        configuration, as infrastructure typically varies across environments.
        For example, in a test environment you might use a simple, in-memory
        data source, but in production you'll use a shared connection pool
        talking to a database server. By putting your infrastructure in
        another file, you can change it without effecting your application
        configuration.</p><p>Don't worry about the infrastructure configuration for now.
        Simply define four beans in your
        <code class="filename">application-config.xml</code> file to reflect the
        configuration in the 'application-config.xml' box of the <a href="xml-dependency-injection.html#rewards-configuration-diagram-application">diagram</a>. It's okay to assume the
        <code class="interfacename">dataSource</code> bean referenced by each
        repository is defined in another file: you'll see how to combine and
        visualize beans partitioned across multiple files in a later step. For
        consistency with the rest of the lab, give your
        <code class="classname">RewardNetworkImpl</code> bean an id of
        <code class="literal">rewardNetwork</code>.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip: Define each bean, then define the references between beans"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Define each bean, then define the references between beans</th></tr><tr><td align="left" valign="top"><p>As you start working in
          <code class="literal">application-config.xml</code>, consider creating a <a href="spring-configuration.html#barebones-bean-def" title="A.1.&nbsp;Bare-bones Bean Definitions">bare-bone bean definition</a> for
          each of your four application components first, then going back and
          adding bean references to match the <a href="xml-dependency-injection.html#rewards-configuration-diagram-application">diagram</a> above.</p></td></tr></table></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip: Follow bean naming conventions"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Follow bean naming conventions</th></tr><tr><td align="left" valign="top"><p>As you define each bean, follow bean naming conventions. The
          arrows in the <a href="xml-dependency-injection.html#rewards-configuration-diagram-application">diagram</a> representing bean references follow the
          recommended naming convention.</p><p>A bean's name should describe the <span class="emphasis"><em>service</em></span>
          it provides. It should not describe implementation details.
          For this reason, a bean's name often corresponds to its
          <span class="emphasis"><em>service interface</em></span>. For example, the class
          <code class="classname">JdbcAccountRepository</code> implements the
          <code class="interfacename">AccountRepository</code> interface. This
          interface is what callers work with. By convention, then, the bean
          name should be <code class="literal">accountRepository</code>.</p></td></tr></table></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip: Use Eclipse XML auto-completion"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Use Eclipse XML auto-completion</th></tr><tr><td align="left" valign="top"><p>As you define each bean, have Eclipse auto-suggest XML tags
          for you. Press <code class="literal">Ctrl+Space</code> inside a tag and
          Eclipse will suggest what's legal based on the XSD you are using.
          In-line documentation of each tag will also be displayed.</p></td></tr></table></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip: Use bean class name auto-completion"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Use bean class name auto-completion</th></tr><tr><td align="left" valign="top"><p>As you define each bean, have SpringSource Tool Suite <a href="spring-configuration.html#bean-class-autocomplete-tip" title="A.2.&nbsp;Bean Class Auto-Completion">auto-complete the bean's class name</a> for you. When you add a <code class="literal">bean</code> tag, for
          the <code class="literal">class</code> attribute type the capital letters of
          the class name (i.e. 'JAR' for
          <code class="classname">JdbcAccountRepository</code>) or the first couple of
          letters of the name (i.e. 'JdbcA' for
          <code class="classname">JdbcAccountRepository</code>) and press
          <code class="literal">Ctrl+Space</code> and you'll see a list of suggested
          class names.</p></td></tr></table></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip: Use constructor-arg auto-completion"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Use constructor-arg auto-completion</th></tr><tr><td align="left" valign="top"><p>For beans with constructor arguments, have SpringSource Tool
          Suite <a href="spring-configuration.html#constructor-args-autocomplete-tip" title="A.3.&nbsp;Constructor Arguments Auto-Completion">auto-complete constructor-args</a> for you. When you add a
          <code class="literal">constructor-arg</code> tag press
          <code class="literal">Ctrl+Space</code> in the <code class="literal">ref</code>
          attribute and you'll see suggestions of legal values.</p></td></tr></table></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip: Use property auto-completion"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Use property auto-completion</th></tr><tr><td align="left" valign="top"><p>For beans with settable properties, have SpringSource Tool
          Suite <a href="spring-configuration.html#properties-autocomplete-tip" title="A.4.&nbsp;Bean Properties Auto-Completion">auto-complete properties</a> for you. When you add a
          <code class="literal">property</code> tag press <code class="literal">Ctrl+Space</code>
          in the <code class="literal">name</code> and <code class="literal">ref</code> attributes
          and you'll see suggestions of legal values.</p></td></tr></table></div><p>Once you have the four beans defined and referenced as shown in the
        <a href="xml-dependency-injection.html#rewards-configuration-diagram-application">diagram</a>, move on to the next step!</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="details.app-visualization"></a>3.1.2.&nbsp;Visualize the application configuration file</h4></div></div></div><p>So you defined your four beans in
        <code class="filename">application-config.xml</code>. How can you verify you
        defined them correctly? One way is to use SpringSource Tool Suite to
        visualize your configuration. In this next step you'll use
        SpringSource Tool Suite to graph the beans in your
        <code class="filename">application-config.xml</code> file.</p><p>To enable SpringSource Tool Suite graphing, you must tell
        Eclipse your project is a SpringSource Tool Suite project. In your
        case that was done automatically when you added the Spring Bean
        Configuration File, otherwise you can add the Spring project nature
        through the <span class="emphasis"><em>Spring Tools</em></span> context menu of your
        project.</p><p>You'll see your project's icon now has a "S" annotation
        indicating it's a SpringSource Tool Suite project:</p><div class="mediaobject" align="center"><a name="spring-ide-project"></a><img src="images/xml-dependency-injection/spring-ide-project.png" align="middle"><div class="caption"><p>Figure 7: <code class="literal">xml-dependency-injection</code> is a Spring project</p></div></div><p>SpringSource Tool Suite also needs to know about your bean
        definition files. Again, this was done automatically when you used the
        wizard to add the new configuration file. To do this manually for
        files that were not created with the wizard, you can right-click your
        <code class="literal">xml-dependency-injection</code> project, select
        <span class="emphasis"><em>Properties</em></span>, and navigate to the <code class="literal">Spring -&gt; Beans Support</code> tab.</p><p>With the file added, now tell SpringSource Tool Suite to
        visualize it. For graphing beans in a single file, there are two ways to do this. The simplest way is to simply select the <span class="emphasis"><em>beans graph</em></span> tab on the editor window for the <code class="filename">application-config.xml</code> file. </p><div class="mediaobject" align="center"><a name="spring-ide-open-graph_1"></a><img src="images/xml-dependency-injection/beans-graph-tab.png" align="middle"><div class="caption"><p>Figure 8: Show Dependency Graph</p></div></div><p>Alternatively, you can open the dependency graph in a separate editor window.  Switch to  the <span class="emphasis"><em>Spring Explorer</em></span> view and  expand
        the <code class="literal">xml-dependency-injection</code> project, right-click
        on <code class="filename">application-config.xml</code> and select
        <span class="emphasis"><em>Open Graph</em></span>.</p><div class="mediaobject" align="center"><a name="spring-ide-open-graph"></a><img src="images/xml-dependency-injection/spring-ide-open-graph.png" align="middle"><div class="caption"><p>Figure 9: Open Dependency Graph</p></div></div><p>In either case, the resulting graph should look like:</p><div class="mediaobject" align="center"><a name="spring-ide-application-config-graph2"></a><img src="images/xml-dependency-injection/spring-ide-application-config-graph.png" align="middle"><div class="caption"><p>Figure 10: <code class="filename">application-config.xml</code> visualized with SpringSource Tool Suite</p></div></div><p>When you see the equivalent of the above <a href="xml-dependency-injection.html#spring-ide-application-config-graph2">graphic</a> in your graph of
        <code class="filename">application-config.xml</code>, move on to the next step!
        If you see something different, head back to your configuration to
        find the issue. When you make a change to your configuration, refresh
        your graph.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="details.infra-config"></a>3.1.3.&nbsp;The infrastructure configuration needed to test the application</h4></div></div></div><p>In the previous step you created and visualized bean definitions
        for your application components. In this step we'll investigate the
        infrastructure configuration necessary to test your application.
        You'll then visualize the entire test configuration.</p><p>To test your application, each JDBC-based repository needs a
        <code class="interfacename">DataSource</code> to work. For example, the
        <code class="classname">JdbcRestaurantRepository</code> needs a
        <code class="interfacename">DataSource</code> to load
        <code class="classname">Restaurant</code> objects by their merchant numbers
        from rows in the <code class="literal">T_RESTAURANT</code> table. So far,
        though, you have not defined any
        <code class="interfacename">DataSource</code> implementation (you can see
        this graphically in the <a href="xml-dependency-injection.html#spring-ide-application-config-graph2">graphic</a> as the 'dataSource' references are
        dangling). In this step you'll see how to setup a
        <code class="interfacename">DataSource</code> in a separate configuration
        file in your test tree. It's in the test area, because it is only for
        testing - it is not the one you would use in production.</p><p>In the <code class="filename">src/test/java</code> source folder,
        navigate to the root <code class="filename">rewards</code> package. There you
        will find a file named
        <code class="filename">test-infrastructure-config.xml</code>. Open it.</p><p>You will see that a dataSource is already configured for you.
        You don't need to make any changes to this file but you do need to
        understand what we have defined here for you.</p><p>Spring ships with decent support for creating
        <code class="interfacename">DataSource</code>s based on in-memory
        databases such as H2, HSQLDB and Derby. So the dataSource class is <code class="classname">EmbeddedDatabaseFactoryBean</code>. </p><p> As you can see, <code class="interfacename">EmbeddedDatabaseFactoryBean</code> relies on a 
        separate bean definition (<code class="classname">ResourceDatabasePopulator</code>).
        </p><p>Both configuration files can be loaded as scripts and both are on the
        classpath, so you can use Spring's resource loading mechanism and
        prefix both of the paths with <code class="literal">classpath:</code>. Note that
        the scripts will be run in the order specified (top to bottom) so the
        order matters in this case. </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip: jdbc namespace"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">jdbc namespace</th></tr><tr><td align="left" valign="top"><p>You will see in the next lab that there is a much simpler way to configure an embedded datasource. 	
          This one relies on the 'jdbc' namespace which we haven't discussed yet.  </p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="details.visualize-all"></a>3.1.4.&nbsp;Visualize the complete test configuration</h4></div></div></div><p>So far you've defined the configuration for your application and
        the infrastructure necessary to system test your application. In this
        step you'll use SpringSource Tool Suite to visualize your complete
        system test configuration across the two files.</p><p>Right-click on your <code class="literal">xml-dependency-injection</code>
        project and select <span class="emphasis"><em>Properties</em></span>. Select the
        <code class="literal">Spring -&gt; Beans Support</code> tab and
        <span class="emphasis"><em>Add...</em></span> your
        <code class="filename">test-infrastructure-config.xml</code> to the Config
        Files list.</p><p>Now group the two files together into a logical 'systemTest'
        Config Set. To do this, select the Config Sets tab and select
        <span class="emphasis"><em>New...</em></span> In the dialog, enter the Config Set name,
        select the config files to include, and select
        <span class="emphasis"><em>OK</em></span>:</p><div class="mediaobject" align="center"><a name="new-config-set"></a><img src="images/xml-dependency-injection/new-config-set.png" align="middle"><div class="caption"><p>Figure 11: New Config Set</p></div></div><p>Now graph your new 'systemTest' Config Set. In your Spring
        Explorer view, right-click on the set and select <span class="emphasis"><em>Open Graph</em></span>. Your graph should look like:</p><div class="mediaobject" align="center"><a name="system-test-configset"></a><img src="images/xml-dependency-injection/system-test-configset.png" align="middle"><div class="caption"><p>Figure 12: The rewards application - system test configuration</p></div></div><p>Notice how the <code class="literal">dataSource</code> bean is now part of
        the graph, as the graph is now visualizing the combined configuration
        across the <code class="filename">application-config.xml</code> and
        <code class="filename">test-infrastructure-config.xml</code> files. </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>It's possible that you still see warning or even error
            overlays in the icons shown in the diagram. This is caused by a
            bug in the Eclipse icon cache and does not mean that you did
            something wrong! As long as there are no warnings or errors in
            your config files you're fine.</p></td></tr></table></div><p>When you see the equivalent of the <a href="xml-dependency-injection.html#system-test-configset">graphic</a> in your
        graph of <code class="filename">application-config.xml</code>, move on to the
        next step!</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="testing"></a>3.2.&nbsp;System testing the application with Spring and JUnit</h3></div></div></div><p>In this final section you will test your rewards application with
      Spring and JUnit. You'll first implement the test setup logic to create
      a Spring <code class="interfacename">ApplicationContext</code> that
      bootstraps your application. Then you'll implement the test logic to
      exercise and verify application behavior.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Note that what we have done is configure Spring's bean
        visualization tool to show the bean configuration that you want to
        use. This does not define what actually happens at runtime - you need
        to create and configure an <code class="classname">ApplicationContext</code>
        to do that - that is part of the next step. Remember: the visualizer
        is optional and it is up to you to setup a config set in the Spring
        Explorer that matches what you configure in the application.</p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="details.system-test-create"></a>3.2.1.&nbsp;Create the system test class</h4></div></div></div><p>Start by creating a new JUnit Test Case called
        <code class="classname">RewardNetworkTests</code> in the
        <code class="literal">rewards</code> package inside the
        <code class="literal">src/test/java</code> source folder. Use the <span class="emphasis"><em>New -&gt; Other -&gt; Java -&gt; JUnit Test Case</em></span> wizard to help
        you (note that you might need to change the version of JUnit that will
        be used to 4):</p><div class="mediaobject" align="center"><a name="new-rewardnetworktests"></a><img src="images/xml-dependency-injection/new-rewardnetworktests.png" align="middle"><div class="caption"><p>Figure 13: Creating the RewardNetworkTests TestCase using the JUnit Test Case wizard</p></div></div><p>Once you have your <code class="classname">RewardNetworkTests</code>
        class created, move on to the next step!</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="details.system-test-setup"></a>3.2.2.&nbsp;Implement the test setup logic</h4></div></div></div><p>In this step you'll implement the setup logic needed to run your
        system test. You'll first create a Spring
        <code class="interfacename">ApplicationContext</code> that bootstraps your
        application, then lookup the bean you'll use to invoke the
        application.</p><p>First, ensure you have a <code class="methodname">public void setUp()</code> method annotated with
        <code class="interfacename">@org.junit.Before</code>. (this was done for
        you when you checked the <code class="methodname">setUp()</code> checkbox in
        JUnit test case wizard)</p><p>Within <code class="methodname">setUp()</code>, create a new
        <code class="interfacename">ClassPathXmlApplicationContext</code>,
        providing it the class paths to your
        <code class="filename">application-config.xml</code> and
        <code class="filename">test-infrastructure-config.xml</code> files. Doing this
        will bootstrap your application by having Spring create, configure,
        and assemble all beans defined in those two files.</p><p>Next, ask the context to get the
        <code class="literal">rewardNetwork</code> bean for you, which represents the
        entry-point into the rewards application. Assign the bean to a private
        field of type <code class="interfacename">RewardNetwork</code> you can
        reference from your test methods.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Be sure to assign the reference to the
          <code class="literal">rewardNetwork</code> bean to a field of type
          <code class="interfacename">RewardNetwork</code> and not
          <code class="classname">RewardNetworkImpl</code>. A Spring
          <code class="interfacename">ApplicationContext</code> encapsulates the
          knowledge about which component implementations have been selected
          for a given environment. By working with a bean through its
          interface you decouple yourself from implementation complexity and
          volatility.</p></td></tr></table></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Don't ask the context for beans "internal" to the application.
          The <code class="interfacename">RewardNetwork</code> is the
          application's entry-point, setting the boundary for the application
          defined by a easy-to-use public interface. Asking the context for an
          internal bean such as a repository or data source is
          questionable.</p></td></tr></table></div><p>Now verify that Spring can successfully create your application
        on test <code class="methodname">setUp</code>. To do this, create a public
        void test method called <code class="methodname">testRewardForDining()</code>
        and annotate it with <code class="interfacename">@org.junit.Test</code>.
        Leave the method body blank for now. Then, run your test class by
        selecting it and accessing <span class="emphasis"><em>Run -&gt; Run As -&gt; JUnit Test</em></span> from the menu bar (you may also use the <span class="emphasis"><em>Alt + Shift + X then T</em></span> shortcut to do this). After your test
        runs, you should see the green bar indicating
        <code class="methodname">setUp</code> ran without throwing any exceptions. If
        you see red, inspect the failure trace in the JUnit view to see what
        went wrong in the setup logic. Carefully inspect the stack trace-
        Spring error messages are usually very detailed in describing what
        went wrong.</p><p>Once you have the green bar, move on to the next step!</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="details.system-test-implement"></a>3.2.3.&nbsp;Implement the test logic</h4></div></div></div><p>With the test setup logic implemented, you're ready to test your
        application. In this step, you'll invoke the
        <code class="interfacename">RewardNetwork.rewardAccountFor(Dining)</code>
        method to verify all pieces of your application work together to carry
        out a successful reward operation.</p><p>You will not have to write the Unit Test yourself. Have a look
        at
        <code class="methodname">RewardNetworkImplTest.testRewardForDining()</code>.
        You can just copy and paste its content into
        <code class="methodname">RewardNetworkTests.testRewardForDining()</code>.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>In a real life application you would not have the same content
          for both tests. We are making things fast here so you can focus on
          Spring configuration rather than spending time on writing the test
          itself.</p></td></tr></table></div><p>You can now run your test in Eclipse. This time you may simply
        select the green play button on the tool bar to <span class="emphasis"><em>Run Last Launched</em></span> (Ctrl+F11).</p><p>When you have the green bar, congratulations! You've completed
        this lab. You have just used Spring to configure the components of a
        realistic Java application and have exercised application behavior
        successfully in a test environment inside your IDE.</p></div></div></div></div><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navfooter"><hr></hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="spring-intro-lab.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="xml-dependency-best-practices.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Introduction to Core Spring&nbsp;</td><td width="20%" align="center"><span style="color:white;font-size:90%;"><a href="http://www.springsource.com/" title="SpringSource">By SpringSource</a></span></td><td width="40%" align="right" valign="top">&nbsp;Dependency Injection Best Practices</td></tr></table></div></body></html>